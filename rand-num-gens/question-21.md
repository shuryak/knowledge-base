# Закон №21. Генерация методом композиции

Метод композиции применим к генерации случайных величин, функция распределения
которых может быть выражена в виде выпуклой комбинации других функций
распределения.

Пусть
$F\left(x\right) = \sum\limits_{j = 1}^{\infty} p_j \cdot F_j\left(x\right)$,
где $p_j \geqslant 0$ и $\sum\limits_{j = 1}^{\infty} p_j = 1$. Количество
слагаемых может быть конечным.

Алгоритм генерации случайной величины $X$ с функцией распределения
$F\left(x\right)$ следующий:

1. Генерируется целое положительное число $J$, для которого
   $\mathrm{P}\left(J = j\right) = p_j$.
2. [Генерируется](./question-1.md) равномерно распределённое в
   $\left[0, \, 1\right)$ число $U$.
3. Искомая случайная величина $X = F_j^{-1}\left(U\right)$.

> Действительно,
> $\mathrm{P}\left(X < x\right) = \sum\limits_{j = 1}^{\infty} \mathrm{P}\left(\left\{X < x\right\} / \left\{J = j\right\}\right) \cdot \mathrm{P}\left(J = j\right) = \sum\limits_{j = 1}^{\infty} F_j\left(x\right) \cdot p_j = F\left(x\right)$.

---

> [!TIP] Пример
>
> Применим метод композиции для двойного экспоненциального распределения,
> которое задаётся функцией плотности
> $p\left(x\right) = \dfrac{1}{2} \cdot e^{-\left|x\right|}$.
>
> Эту функцию можно представить как комбинацию двух экспоненциальных
> распределений с плотностями
> $p_1\left(x\right) = \begin{cases}e^{-x}, \, x \geqslant 0 \\ 0, \, x < 0\end{cases}$
> и
> $p_2\left(x\right) = \begin{cases}e^x, \, x \leqslant 0 \\ 0, \, x > 0\end{cases}$.
>
> Тогда
> $p\left(x\right) = \dfrac{1}{2} \cdot p_1\left(x\right) + \dfrac{1}{2} \cdot p_2\left(x\right)$.
>
> Алгоритм генерации двойного экспоненциального распределения:
>
> 1. [Генерируются](./question-1.md) равномерно распределённые в
>    $\left(0, \, 1\right)$ числа $U_1$ и $U_2$.
> 2. Если $U_1 < \dfrac{1}{2}$, то искомая случайная величина $X = -\ln{U_2}$,
>    иначе $X = \ln{U_2}$
